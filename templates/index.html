<!DOCTYPE html>
<html>
<head>
    <title>Tomato Disease Detector üçÖ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(to bottom right, #d9f7d6, #fff);
            text-align: center;
            padding: 20px;
        }

        h2 {
            font-size: 26px;
            margin-bottom: 18px;
            font-weight: bold;
            color: #145a32;
        }

        .container {
            width: 400px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0px 0px 18px rgba(0, 0, 0, 0.17);
        }

        #imgBox {
            width: 100%;
            height: 260px;
            border: 2px dashed #aaa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            background: #f3f3f3;
            margin-bottom: 12px;
        }

        #preview {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        input[type="file"] {
            margin: 10px;
        }

        button {
            background: #1565c0;
            color: white;
            padding: 10px 18px;
            font-size: 16px;
            border: none;
            cursor: pointer;
            margin: 10px;
            border-radius: 6px;
            width: 48%;
        }

        button:hover {
            background: #0d47a1;
        }

        #resultBox {
            display: none;
            margin-top: 18px;
            background: #e8f5e9;
            padding: 12px;
            border-radius: 10px;
        }

        img#gradcam {
            width: 100%;
            border-radius: 8px;
            margin-top: 12px;
            display: none;
        }

        .error {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
    </style>
</head>

<body>

    <div class="container">
        <h2>Tomato Disease Detector üçÖ</h2>

        <div id="imgBox">
            <img id="preview" src="">
        </div>

        <input type="file" id="file" accept="image/*"><br>

        <button onclick="predict()">Predict</button>
        <button onclick="resetAll()" style="background:#c62828;">Reset</button>

        <p id="filename"></p>

        <div id="resultBox">
            <h3>Result:</h3>
            <p id="disease"></p>
            <p id="confidence"></p>
            <p id="severity"></p>
            <p id="stage"></p>
            <p id="risk"></p>
            <img id="gradcam">
        </div>

        <p id="error" class="error"></p>

    </div>

<script>
    let selectedFile = null;
    document.getElementById("file").addEventListener("change", function(event){
        selectedFile = event.target.files[0];
        document.getElementById("preview").src = URL.createObjectURL(selectedFile);
        document.getElementById("filename").innerText = selectedFile.name;
        document.getElementById("resultBox").style.display = "none";
        document.getElementById("error").innerText = "";
        document.getElementById("gradcam").style.display = "none";
    });

    async function predict(){
        if(!selectedFile){
            alert("Please upload an image!");
            return;
        }

        let formData = new FormData();
        formData.append("file", selectedFile);

        let res = await fetch("/predict", { method: "POST", body: formData });
        let data = await res.json();

        if(data.error){
            document.getElementById("error").innerText = data.message;
            document.getElementById("resultBox").style.display = "none";
            document.getElementById("gradcam").style.display = "none";
            return;
        }

        document.getElementById("error").innerText = "";
        document.getElementById("resultBox").style.display = "block";

        document.getElementById("disease").innerText = "Disease: " + data.disease;
        document.getElementById("confidence").innerText = "Confidence: " + (data.confidence*100).toFixed(2) + "%";
        document.getElementById("severity").innerText = "Severity: " + data.severity + "%";
        document.getElementById("stage").innerText = "Stage: " + data.stage;
        document.getElementById("risk").innerText = "Future Risk: " + data.future_risk;

        document.getElementById("gradcam").src = data.gradcam + "?t=" + new Date().getTime();
        document.getElementById("gradcam").style.display = "block";
    }

    function resetAll(){
        selectedFile = null;
        document.getElementById("file").value="";
        document.getElementById("preview").src="";
        document.getElementById("filename").innerText="";
        document.getElementById("resultBox").style.display="none";
        document.getElementById("error").innerText="";
        document.getElementById("gradcam").style.display = "none";
    }
</script>

</body>
</html>